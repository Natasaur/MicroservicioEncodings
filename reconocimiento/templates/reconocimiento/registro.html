{% extends "reconocimiento/index.html" %}

{% block title %}Registro de Alumno{% endblock %}

{% block content %}
    <div class="card">
        <h3>Registro</h3>

        <div class="card" style="background-color: #fffbea; border-left: 6px solid #ffc107;">
            <h4>üì∏ Recomendaciones para subir tu foto</h4>
            <ul>
                <li>Rostro de frente, completo y bien centrado</li>
                <li>Buena iluminaci√≥n, sin sombras ni contraluces</li>
                <li>Fondo sencillo (pared blanca o similar)</li>
                <li>Sin lentes oscuros, gorras ni cubrebocas</li>
                <li>Una sola persona en la imagen</li>
                <li>Sin filtros ni ediciones</li>
                <li>Formato JPG o PNG, imagen clara y n√≠tida</li>
            </ul>
        </div>

        <div class="card" style="background-color: #fffbea; border-left: 6px solid #ffc107;">
            <strong>‚ö† Importante:</strong> Aseg√∫rate de que solo t√∫ aparezcas en la foto. Si el sistema detecta m√°s de un rostro, no se permitir√° el registro o la asistencia.
        </div>

        <form id="registro-form">
            <input type="text" name="matricula" placeholder="Matr√≠cula:" required><br>
            <input type="text" name="nombre" placeholder="Nombre:" required><br>
            <input type="text" name="apellido_paterno" placeholder="Apellido paterno:" required><br>
            <input type="text" name="apellido_materno" placeholder="Apellido materno:" required><br>
            <input type="text" name="grupo" placeholder="Grupo:" required><br>
            <input type="text" name="ciclo" placeholder="Ciclo Escolar:" required><br>
            <input type="text" name="contacto" placeholder="Contacto: 55 1234 5678" required><br>
            <label>Foto de rostro:</label><br>
            <input type="file" name="imagen" accept="image/*" required><br><br>
            <button type="submit">Registrarse</button>
        </form>

        <div id="mensaje" style="margin-top: 15px;"></div>
    </div>

    <script>
        const token = localStorage.getItem('jwt');
        if (!token) {
            alert("Por favor inicia sesi√≥n primero");
            window.location.href = "/login/";
        }

        const form = document.getElementById('registro-form');
        const mensaje = document.getElementById('mensaje');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            const formData = new FormData(form);

            try {
                const response = await fetch('/registro/', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer ' + token
                    },
                    body: formData
                });

                const data = await response.text();

                if (response.ok) {
                    mensaje.innerHTML = '<p style="color: green;"><strong>Registro exitoso</strong></p>';
                    form.reset();
                } else {
                    mensaje.innerHTML = '<p style="color: red;"><strong>' + data + '</strong></p>';
                }
            } catch (error) {
                mensaje.innerHTML = '<p style="color: red;"><strong>Error al conectar con el servidor.</strong></p>';
            }
        });
    </script>
{% endblock %}